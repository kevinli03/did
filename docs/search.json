[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Difference-in-Differences (DiD) Resources",
    "section": "",
    "text": "Welcome!\nDifference-in-differences (DiD) is one of the most widely used methods for estimating causal effects. It is often the go-to design for Policy analysts, Economists, and Epidemiologists.\nThis repository is a collection of resources on the causal identification strategy of Difference-in-Differences (DiD). This repository includes:\n\nA basic overview of DiD, including how it works, and the assumptions. A look at the TWFE estimator in classic DiD.\nA series of modern estimators that address issues with TWFE, including a brief description/vignette and R-code.\nA series of additional tests/visualisations useful for DiD.\n\n\nIn the appendix, I also include some methods that are not DiD but can be used for causal panel analysis.\n\n\n\n\nAdditional Resources\n\n\n\nResource\nAuthor\nNotes\n\n\n\n\nYiqing Xu: modern advancements in DiD\nYiqing Xu\nUseful overview of all modern DiD methods and R code.\n\n\nAsjad Naqvi: repository on DiD\nAsjad Naqvi\nUseful R and state code for DiD.\n\n\nUser Guides for DiD\nBrantly Callaway\nUseful guides and explanations of DiD with R.\n\n\nLecture: Problems with TWFE\nPedro Sant’Anna\nBacon decomposition and introduction to csdid.\n\n\nCausal Inference: The Mixtape\nScott Cunningham\nTextbook chapter introducing DiD.\n\n\nChiu et al (2025)\nChiu et al\nPaper exploring new DiD methods and reanalysing old polisci papers.\n\n\nRoth et al (2025)\nRoth et al\nAn overview of new DiD methods.\n\n\nLiu et al (2025)\nLiu et al\nAn overview of imputation DiD methods.\n\n\n\n\n\n\nAcknowledgements\nThis repository was created to help me collect all that I had learned about DiD together into one place. I hope this can be helpful for others.\nI would like to thank the following individuals for teaching me so much about DiD and causal inference during my Master’s degree at LSE:\n\nDr. Daniel de Kadt\nDr. Aliz Toth",
    "crumbs": [
      "Welcome!"
    ]
  },
  {
    "objectID": "did.html",
    "href": "did.html",
    "title": "Basics of DiD",
    "section": "",
    "text": "What is DiD?\nDifference-in-differences (DiD) is a causal identification strategy that can help us estimate causal effects, and go from correlation to causation.\nFor an example, let us consider the famous paper by Card and Kreuger (1993).\n\nContext: New Jersey increased its minimum wage in April of 1992.\nQuestion: How did raising the minimum wage affect the employment rates at fast-food restaurants?\n\nWe have data on employment rates in New Jersey in March 1992, before the minimum wage increase, and data from December 1992, after the minimum wage increase. The data looks like this:\n\n\n\n\n\n\n\n\n\nBased on this data, it might be tempting to say something like this:\n\nThe employment rate in December 1992 is 4 units higher than than the employment rate in March. Thus, the causal effect of the minimum wage increase is 4 units.\n\nHowever, this would be the wrong conclusion. Why? Well something could have happened between March and December. Perhaps there was a giant country-wide economic boom which caused the increase in employment, which had nothing to do with minimum wage in New Jersey.\nDifference-in-differences is a solution to this problem. DiD tells us too look at another state - a state that did not receive the treatment. Nearby Pennsylvania did not increase its minimum wage during this time period. Let us see how their employment rate is doing:\n\n\n\n\n\n\n\n\n\nPennsylvania gives us the trend in employment rate if no minimum wage increase occurred. We then make an assumption - had New Jersey not undergone a minimum wage increase, it would have followed the same trend in employment rates.\n\n\n\n\n\n\n\n\n\nThus, difference-in-differences allows us to estimate the causal effect of a treatment by looking at the trend of an untreated unit, and using that trend to approximate what would have happened if the treatment never occurred.\n\n\n\nParallel Trends Assumption\nThe key assumption behind DiD is the parallel trends assumption - that indeed, New Jersey would have followed the same trend as Pennsylvania, had New Jersey not had the minimum wage increase. Or in the figures above, that New Jersey would have indeed followed the dotted purple line trend if it had not had a minimum wage increase.\nMore generally, the parallel trends assumption says that if the treated units had been hypothetically untreated, they would have followed the same trend in the outcome variable as the untreated units.\nWhat can go wrong when parallel trends is violated? Consider the same example above, but somehow, we were able to magically see what really happened to New Jersey without a minimum wage increase. Let us pretend that New Jersey alone (and not Pennsylvania) suffered from some mighty economic crash.\n\n\n\n\n\n\n\n\n\nWe can see that in this scenario, the true New Jersey trend (solid purple) is not parallel to the Pennsylvania trend. Thus, if we were to assume the Pennsylvania trend on the New Jersey trend (dotted purple), our estimate of the causal effect would be wrong.\nHow do we check the parallel trends assumption? Unfortunately, it is impossible to actually check it, since it involves a hypothetical outcome (New Jersey not getting the minimum wage increase).\nHowever, we often test for parallel trends in the years before the treatment starts (pre-treatment periods). The idea is that if there are parallel trends for several years before the start of treatment, then it is likely to continue into the treatment period.\nWe can also control for covariates (other variables) that we believe might cause violations in parallel trends. Typically covariates that cause violations of parallel trends are:\n\nCorrelated with the outcome variable.\nHave different trends in the untreated and treated groups.\n\n\n\n\nATT and Dynamic Effects\nThe main causal effect of interest in DiD is the average treatment effect on the treated (ATT). This is the causal effect of treatment on units that receive the treatment.\n\nImportant! This is not the same as the average treatment effect (ATE). That applies to all units, including untreated units. The ATT only applies to treated units, and cannot easily be generalised to untreated units.\n\nWe are often also interested in what is called dynamic treatment effects. These are essentially ATT estimates for every year in our data.\nFor example, let us say that after New Jersey legalised minimum wage, we continued to observe the employment rates for the next 5 years (as well as those in Pennsylvania). We can then create dynamic treatment effects for each of the next 5 years - which will help us visualise how the treatment effects change over time.\nDynamic treatment effects are also not only limited to the post-treatment period. If we had data before the treatment took place, we could also calculate dynamic treatment effects for each period. This is useful because we can use this to test for parallel trends.\nThis is because we shouldn’t expect the treatment and control groups to differ in their pre-treatment trends if parallel trends is met, and thus, the treatment effect should be 0 or close to 0 in the pre-treatment period. if this is not the case, then we have evidence that parallel trends is violated.\n\n\n\nStaggered and Absorbing\nDiD designs can be categorised by two factors: if treatment is staggered and if treatment is absorbing.\nNon-staggered treatment means all units that receive the treatment in our study receive it at the same time. For example, in our New Jersey example, all fast food restaurants in New Jersey experienced the minimum wage rise at the same time.\nStaggered treatment means units start treatment at different times in our study. This is often the case when we are studying multiple states - where some states begin some treatment earlier than others.\nAbsorbing treatment means units who get treated, always remain treated for the rest of our study. For example, in our New Jersey example, all fast food restaurants in New Jersey who got the minimum wage rise, remained with the higher minimum wage.\nNon-Absorbing treatment means units who get treated might return to being untreated. For example, this could happen if New Jersey decides a few years later to lower the minimum wage back to its original level.\nThese terms will become important when we explore the issues with two-way fixed effects, and why econometricians have spent 2021-onwards trying to solve those issues.",
    "crumbs": [
      "Basics of DiD"
    ]
  },
  {
    "objectID": "twfe.html",
    "href": "twfe.html",
    "title": "Two-Way Fixed Effects",
    "section": "",
    "text": "What is TWFE?\nTwo-way fixed effects (TWFE) is the primary estimator used to estimate causal effects in difference-in-differences. The TWFE estimator is a regression model specified as follows:\n\\[\nY_{it} = \\underbrace{\\alpha_i + \\gamma_t}_\\text{fixed effects} + D_{it}\\tau + \\cov + \\eps_{it}\n\\]\n\n\\(Y_{it}\\) is the outcome, \\(D_{it}\\) is the treatment, \\(\\b X_{it}\\) is a vector of covariates (optional) for parallel trends, and \\(\\tau\\) is the causal effect.\n\nFor dynamic treatment effects, the TWFE model is estimated as:\n\\[\nY_{it} = \\underbrace{\\alpha_i + \\gamma_t}_\\text{fixed effects} + \\sum_{r ≠ -1} 1\\{R_{it} = r\\} \\cdot \\tau_r + \\eps_{it}\n\\]\n\n\\(R_{it}\\) is a relative-time variable, that is equal to the time period \\(t\\) minus the initial treatment period of unit \\(i\\). \\(1\\{R_{it}=r\\}\\) is an indicator variable that equals 1 if \\(R_{it} = r\\), and 0 otherwise.\n\nFixed effect \\(\\alpha_i\\) accounts/controls for differences between units, and \\(\\gamma_t\\) accounts/controls for differences between time periods. If we account for differences between units and differences between time periods, the only possible confounders remaining are unit-specific trends over time. But with the parallel trends assumption, we rule out this type of confounder.\nThus, under the parallel trends assumption, there are no omitted confounders/variables, and our regression is exogenous. Since OLS is unbiased under exogeneity, our TWFE estimator for \\(\\tau\\) is unbiased.\n\n\n\nIssues with TWFE\nTWFE has been shown to be a biased estimator (bad estimator) for the ATT and dynamic treatment effects when dealing with staggered treatment implementation. So when units begin treatment at different times, TWFE is biased.\nWhy is this? Goodman-Bacon (2021) shows that in a staggered setting, TWFE is actually a weighted average of 4 comparisons:\n\nEarly-treated units vs. untreated units.\nLate-treated units vs. untreated units.\nEarly-treated units vs. late-treated units before treatment.\nEarly-treated units after treatment vs. late-treated units before and after treatment.\n\nWhen we compare treatment to control, we want to compare treated to untreated units. The issue comes with the 4th comparison - we actually use late-treated units after receiving treatment as a untreated comparison. This is called the “forbidden comparison” problem of TWFE.\nDe Chaisemartin and D’Haultœuille (2020) show that there is another problem with TWFE - the weighting of these comparisons when aggregating these comparisons. For an accurate average treatment effect on the treated (ATT), we in theory want to weight each comparison by the proportion of the sample size each comparison contains. For example, if more units are in the early-treated units, we would want to weight that comparison more.\nThe issue with TWFE is that not only does it not weight by group size, it doesn’t even always give positive weights. In fact, sometimes, TWFE will assign negative weights to certain comparisons. This is completely nonsensical, and has been shown to even reverse the sign of the true ATT in simulations.\nThus, TWFE is a biased estimator when it comes to staggered treatment designs. Since 2021, Econometricians have started developing modern estimators that resolve the issues with TWFE.\n\nBrantly Callaway has a more detailed page on the issues with TWFE. Pedro Sant’Anna also has a powerpoint on the Bacon-Goodman decomposition.\n\n\n\n\nR: Setting Up the Data\nOur dataset df should be a panel or repeated cross-section, and have the following variables:\n\n\n\n\n\n\n\nVariable\nDescription\n\n\n\n\nunit\nA variable indicating the units/individual an observation belongs to in our data.*\n\n\ntime\nA variable indicating time-periods in our study for each observation.\n\n\noutcome\nOutcome variable for each observation.\n\n\ntreat\nTreatment variable for each observation. Should equal 1 for treated units and 0 for untreated units.\n\n\nrel.time\nA relative time variable that indicates for the given period \\(t\\) of an observation, how many time-periods away did the unit \\(i\\) first get the treatment. For the never-treated observations, set the value to a very large or small number (-1000 is a common choice).\n\n\ncovar\n(optional) covariate(s) to condition for parallel trends.\n\n\n\n\n*For repeated cross-section, the unit variable should be instead the group/level of which treatment is assigned. For example, if treatment is assigned by county/state, use that as the unit variable.\n\n\n\n\n\n\n\nCreating a rel.time Variable\n\n\n\n\n\nTo create a rel.time variable if your dataset does not have one, we first need to create a first.treat variable, which indicates the period that a unit first gets treated.\n\nlibrary(tidyverse)\n\n# create first.treat\nfirst.treat &lt;- df %&gt;%\n  select(treat, time, unit) %&gt;%\n  filter(treat == 1) %&gt;%\n  group_by(unit) %&gt;%\n  summarise(first.treat = min(time))\n\n# join first.treat to df\ndf &lt;- left_join(df, first.treat)\n\nNow, we can create a rel.time variable:\n\ndf$rel.time &lt;- df$time - df$first.treat\n\n# now set our never-treated rel.time values to a super large or small num\ndf$rel.time &lt;- replace_na(df$rel.time, -1000)\n\n\n\n\n\n\n\nR: Estimating the ATT\nWe use the fixest package to run a TWFE model:\n\nlibrary(fixest)\n\natt &lt;- feols(\n  fml   = outcome ~ treat + covar | unit + time,  # covariate is optional\n  data  = df,                                     # your data\n  vcov  = ~unit                                   # cluster SE by unit\n)\n\nsummary(att)\n\n#&gt; OLS estimation, Dep. Var.: outcome\n#&gt; Observations: 950\n#&gt; Fixed-effects: unit: 95,  time: 10\n#&gt; Standard-errors: Clustered (unit) \n#&gt;       Estimate Std. Error  t value  Pr(&gt;|t|)    \n#&gt; treat -3.68310   0.361071 -10.2005 &lt; 2.2e-16 ***\n#&gt; covar  1.01833   0.032416  31.4142 &lt; 2.2e-16 ***\n#&gt; ---\n#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#&gt; RMSE: 1.60906     Adj. R2: 0.691054\n#&gt;                 Within R2: 0.623425\n\n\nThe coefficient of treat is our estimate of the ATT - the causal effect of treatment on those who receive the treatment. The significance is given by Pr(&gt;|t|) (the p-value) and the stars *** .\n\n\n\n\n\n\nExtracting ATT Directly\n\n\n\n\n\nIf you need to extract the att directly (to create tables or graphs), we can use the coef() function in the fixest package:\n\ncoef(att)\n\n#&gt;     treat     covar \n#&gt; -3.683101  1.018332\n\n\nThis is a table, so we can subset the treatment coefficient directly to extract it.\n\ncoef(att)[1]\n\n#&gt;     treat \n#&gt; -3.683101\n\n\nWe can also directly extract confidence intervals in a similar way.\n\nconfint(att)\n\n#&gt;            2.5 %    97.5 %\n#&gt; treat -4.4000165 -2.966186\n#&gt; covar  0.9539689  1.082695\n\n\nThis is a table, so we can subset the treatment coefficient directly to extract it.\n\nconfint(att)[1,1]\nconfint(att)[1,2]\n\n#&gt; [1] -4.400017\n#&gt; [1] -2.966186\n\n\n\n\n\n\n\n\nR: Estimating Dynamic Effects\nWe use the fixest package to run a TWFE model for dynamic effects:\n\nlibrary(fixest)\n\ndynamic &lt;- feols(\n  fml   = outcome ~ i(rel.time, ref = c(-1, -1000)) + covar | unit + time,\n  # Do not change -1 in c(). You change -1000 to the value of never-treated for rel.time\n  \n  data  = df,     # your data\n  vcov  = ~unit   # cluster SE by unit\n)\n\n# summary(dynamic) if you want to find the actual values of coefficients\n\nWe can plot these results.\n\nlibrary(ggfixest)\nlibrary(ggplot2)\n\nplot &lt;- ggiplot(\n  # required options\n  object   = dynamic,           # input your dynamic model object\n  ref.line = FALSE,             # we will add our own line later\n  \n  # optional aesthetic options\n  xlab     = \"Time Relative to Treatment\",  # x-axis label\n  ylab     = \"Dynamic ATT Estimate\",        # y-axis label\n  main     = \"Dynamic Treatment Effects\",   # title for plot\n)\n\nplot +\n  # select how many period to display\n  xlim(-8, 8) +\n  \n  # add reference lines for treatment beginning and 0 causal effect\n  geom_vline(xintercept = -0.5, linetype = 3) +\n  geom_hline(yintercept = 0, linetype = 3, color = \"red\") +\n  \n  # ggplot theme (optional, change to your liking)\n  theme_bw()\n\n\n\n\n\n\n\n\n\n\nHere we can see all of our dynamic treatment effects plotted. We can split the dynamic treatment effects into 2 groups for interpretation purposes.\n\nPre-treatment (before the white dotted line). If parallel trends assumption is met, then the confidence intervals of the estimates should cover 0 (the red line).\n\n\nIn this example, we can see evidence that parallel trends is violated.\n\n\nPost-treatment (after the white dotted line). These coefficients represent the treatment effect over time. If their confidence intervals do not include 0, that means the treatment effect is significant.\n\n\nIn this example, we can see the initial post-treatment periods have negative effects, but this becomes positive as the years go on.",
    "crumbs": [
      "Two-Way Fixed Effects"
    ]
  },
  {
    "objectID": "sunab.html",
    "href": "sunab.html",
    "title": "1  Interaction-Weighted",
    "section": "",
    "text": "Sun and Abraham (2021)\n\n\nWhat is the IW Estimator?\nThe Interaction-Weighted (IW) estimator, also known as sunab, is an estimator for DiD that solves the issues with TWFE in staggered settings. The estimator was proposed by Sun and Abraham (2021).\nIW is a matching and reweighting estimator for DiD, with the matching part solving the “forbidden comparisons” problem of TWFE, and the reweighting part solving the “negative weighting” problem of TWFE.\nFirst, the IW estimator “matches” treated units to control units in correct non-forbidden comparisons. It does this by separating all treated units into groups, grouped by their initial treatment year. Then, for group, IW compares treated vs. untreated for every year. This “matching” is done via interactions in regression:\n\\[\nY_{it} = \\underbrace{\\alpha_i + \\gamma_t}_\\text{fixed effects} + \\underbrace{\\sum_g \\sum_{r ≠ -1} 1\\{G_i = g\\} \\cdot 1\\{R_{it} = r\\} \\cdot \\tau_{gr}}_\\text{comparisons for each group g and rel.time r} + \\cov + \\eps_{it}\n\\]\n\n\\(G_i\\) is a categorical variable that describes which initial treatment period unit \\(i\\) received treatment. \\(R_{it}\\) is a relative-time variable. Essentially, IW is estimating dynamic treatment effects for each initial treatment period group \\(g\\).\n\nThis matching will produce many different comparison estimates \\(\\tau_{gr}\\). These \\(\\tau_{gr}\\) are reweighted together, with weights determined by how many observations fall into each group \\(g\\) and relative time period \\(r\\). The \\(\\tau_{gr}\\) can be aggregated into the overall ATT, Dynamic ATT’s with all groups combined together, and the overall ATT for each group \\(g\\) separately.\nIW does not accommodate non-absorbing treatment. IW is also less flexible with covariates for parallel trends, since the linear model assumes a linear relationship between covariates and outcome (which might not always be realistic).\n\n\n\nR: Running the Model\nOur dataset df should be a panel or repeated cross-section, and have the following variables:\n\n\n\n\n\n\n\nVariable\nDescription\n\n\n\n\nunit\nA variable indicating the units/individual an observation belongs to in our data.*\n\n\ntime\nA variable indicating time-periods in our study for each observation.\n\n\noutcome\nOutcome variable for each observation.\n\n\ncovar\n(optional) covariate(s) to condition for parallel trends.\n\n\nfirst.treat\nThis variable indicates the initial year of treatment adoption for each unit. For the never-treated, we should set the value of first.treat to a very large positive/negative value that is outside the range of time.\n\n\n\n\n*For repeated cross-section, the unit variable should be instead the group/level of which treatment is assigned. For example, if treatment is assigned by county/state, use that as the unit variable.\n\n\n\n\n\n\n\nCreating a first.treat Variable\n\n\n\n\n\nIf your dataset lacks a first.treat variable, this is how you create one, using the other variables above.\n\nlibrary(tidyverse)\n\n# create first.treat\nfirst.treat &lt;- df %&gt;%\n  select(treat, time, unit) %&gt;%\n  filter(treat == 1) %&gt;%\n  group_by(unit) %&gt;%\n  summarise(first.treat = min(time))\n\n# join first.treat to df\ndf &lt;- left_join(df, first.treat)\n\n# replace NA's (never-treated) in first.treat with big number\ndf$first.treat &lt;- replace_na(df$first.treat, 10000)\n\n\n*For repeated cross-section, the unit variable should be instead the group/level of which treatment is assigned. The treat variable should also be grouped by the same group/level.\n\n\n\n\nWith all the proper variables, we can estimate a IW model with the fixest package:\n\nlibrary(fixest)\n\niw &lt;- feols(\n  fml = outcome ~\n          sunab(first.treat, time) + covar | unit + time,\n  data = df,\n  vcov = ~unit\n)\n\nThis model has now done the matching and estimating \\(\\tau_{gr}\\). We now can choose different ways to aggregate these.\n\n\n\nR: Aggregating the ATT\nTo aggregate the matched treatment effects \\(\\tau_{gr}\\) into a singular ATT causal estimate for all treated observations, we can use the aggregate() function:\n\natt &lt;- aggregate(\n  x   = iw,    # IW model object\n  agg = \"att\"  # output the ATT\n)\n\nprint(att)\n\n#&gt;      Estimate Std. Error   t value     Pr(&gt;|t|)\n#&gt; ATT -1.133749  0.2050705 -5.528584 2.882038e-07\n\n\nWe can see the estimated ATT in the output table, as well as the estimated p-value in Pr(&gt;|t|).\n\n\n\n\n\n\nExtract the ATT Directly\n\n\n\n\n\nIf you are interested in extracting the ATT and confidence intervals directly from the att object for tables/figures, you can do the following:\n\natt &lt;- as.data.frame(att)\n\n# extract att\natt[1,1]\n\n# extract std. error\natt[1,2]\n\n#&gt; [1] -1.133749\n#&gt; [1] 0.2050705\n\n\n\nThis can be useful if you are making a graph/table comparing different estimators.\n\n\n\n\n\n\n\nR: Aggregating Dynamic Effects\nWe can plot the dynamic treatment effects using the IW object estimated when running the model:\n\nlibrary(ggfixest)\nlibrary(ggplot)\n\nplot &lt;- ggiplot(\n  # required options\n  object   = iw,                # input your original iw model\n  ref.line = FALSE,             # we will add our own line later\n  \n  # (optional) aesthetic options\n  xlab     = \"Time Relative to Treatment\",       # x-axis label\n  ylab     = \"Dynamic ATT Estimate\",             # y-axis label\n  main     = \"Dynamic Treatment Effects (IW)\",   # title for plot\n)\n\nplot +\n  # select how many period to display\n  xlim(-8, 8) +\n  \n  # add reference lines for treatment beginning and 0 causal effect\n  geom_vline(xintercept = -0.5, linetype = 3) +\n  geom_hline(yintercept = 0, linetype = 3, color = \"red\") +\n  \n  # ggplot theme (optional, change to your liking)\n  theme_bw()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFinding Exact Dynamic Coefficient Values\n\n\n\n\n\nIf you want exact dynamic coefficient values (to see or for a table), we have to use the aggregate command\n\ndynamic &lt;- aggregate(\n  x   = iw,       # IW model object\n  agg = \"period\"  # output the dynamic effects\n)\n\nhead(dynamic) # print(dynamic) to see all the coefficient values\n\n#&gt;             Estimate Std. Error    t value  Pr(&gt;|t|)\n#&gt; time::-9  0.35176562  0.3590732  0.9796487 0.3297742\n#&gt; time::-8 -0.07900914  0.2974701 -0.2656036 0.7911262\n#&gt; time::-7  0.10104016  0.3669646  0.2753403 0.7836591\n#&gt; time::-6 -0.05640239  0.3089161 -0.1825816 0.8555195\n#&gt; time::-5 -0.29530929  0.2939543 -1.0046095 0.3176640\n#&gt; time::-4 -0.30372133  0.2491128 -1.2192120 0.2258144\n\n\n\n\n\n\n\n\nR: Aggregating Group ATT\nIf we are interested in how the ATT differs by year of treatment adoption, we can also aggregate effects by initial treatment period group:\n\ngroup &lt;- aggregate(\n  x   = iw,       # IW model object\n  agg = \"cohort\"  # output the dynamic effects\n)\n\n# print(group) if you want to see the exact group-ATT numbers\n\nThere isn’t a quick way to immediately plot these estimates, but we can manually create a ggplot:\n\nlibrary(tidyverse)\n\n# make group a df\ngroup &lt;- as.data.frame(group)\n\n# add cohort period to group df\ngroup$period &lt;- rownames(group)\ngroup$period &lt;- as.factor(group$period)\n\n# calculate lower and upper conf intervals\ngroup$lower &lt;- group$Estimate - 1.96*group$`Std. Error`\ngroup$upper &lt;- group$Estimate + 1.96*group$`Std. Error`\n\n# ggplot\nggplot(data = group, aes(x = Estimate, y = period)) +\n  # vertical line at 0 treatment effect\n  geom_vline(xintercept = 0, color = \"red\", linetype = 3) +\n  \n  # plot the treatment effects\n  geom_point(color = \"blue\") +\n  \n  # plot the confidence intervals\n  geom_linerange(aes(xmin = lower, xmax = upper), width = 0.2, color = \"blue\") +\n  \n  # title (optional)\n  labs(title = \"Treatment Effects by Initial Treatment Period\") +\n\n  # x-axis and y-axis labels (optional)\n  xlab(\"Estimated ATT (IW)\") + ylab(\"Initial Treatment Period\") +\n  \n  # theme (optional, change to your liking)\n  theme_bw()\n\n\n\n\n\n\n\n\n\n\n\n\n\nAdditional Resources\nThe main paper:\n\nSun, L. and Abraham S. (2021) ‘Estimating Dynamic Treatment Effects in Event studies with Heterogenous Treatment Effects’, Journal of Econometrics, 225(2), pp. 175-199. Available at: https://arxiv.org/abs/1804.05785\n\nAdditional Resources:\n\nFixest documentation for sunab() function.\nFixest documentation for aggregate() function.\nAsjad Naqvi page on sunab.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Interaction-Weighted</span>"
    ]
  },
  {
    "objectID": "twfe.html#r-estimating-the-att",
    "href": "twfe.html#r-estimating-the-att",
    "title": "Two-Way Fixed Effects",
    "section": "R: Estimating the ATT",
    "text": "R: Estimating the ATT\nWe use the fixest package to run a TWFE model:\n\nlibrary(fixest)\n\natt &lt;- feols(\n  fml   = outcome ~ treat + covar | unit + time,  # covariate is optional\n  data  = df,                                     # your data\n  vcov  = ~unit                                   # cluster SE by unit\n)\n\nsummary(att)\n\n#&gt; OLS estimation, Dep. Var.: outcome\n#&gt; Observations: 950\n#&gt; Fixed-effects: unit: 95,  time: 10\n#&gt; Standard-errors: Clustered (unit) \n#&gt;       Estimate Std. Error  t value  Pr(&gt;|t|)    \n#&gt; treat -3.68310   0.361071 -10.2005 &lt; 2.2e-16 ***\n#&gt; covar  1.01833   0.032416  31.4142 &lt; 2.2e-16 ***\n#&gt; ---\n#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#&gt; RMSE: 1.60906     Adj. R2: 0.691054\n#&gt;                 Within R2: 0.623425\n\n\nThe coefficient of treat is our estimate of the ATT - the causal effect of treatment on those who receive the treatment. The significance is given by Pr(&gt;|t|) (the p-value) and the stars *** .\n\n\nR: Estimating Dynamic Effects\nWe use the fixest package to run a TWFE model for dynamic effects:\n\nlibrary(fixest)\n\ndynamic &lt;- feols(\n  fml   = outcome ~ i(rel.time, ref = c(-1, -1000)) + covar | unit + time,\n  # Do not change -1 in c(). You change -1000 to the value of never-treated for rel.time\n  \n  data  = df,     # your data\n  vcov  = ~unit   # cluster SE by unit\n)\n\nhead(coeftable(dynamic))\n\n#&gt;               Estimate Std. Error  t value     Pr(&gt;|t|)\n#&gt; rel.time::-9 1.7984987  0.3437712 5.231674 1.016192e-06\n#&gt; rel.time::-8 1.0656900  0.3096144 3.441991 8.635334e-04\n#&gt; rel.time::-7 1.2141806  0.3946458 3.076634 2.742407e-03\n#&gt; rel.time::-6 1.0763716  0.3581856 3.005067 3.404009e-03\n#&gt; rel.time::-5 0.6572517  0.2985581 2.201419 3.015397e-02\n#&gt; rel.time::-4 0.6103575  0.2886039 2.114862 3.708716e-02\n\n\nThe output here contains the dynamic effects from rel.time periods -20 to -15. You can see more of them if you get rid of the head() function surrounding the coeftable(dynamic).\nThese results aren’t too useful on their own. It is much more useful to plot these results.\n\nlibrary(ggfixest)\nlibrary(ggplot2)\n\nplot &lt;- ggiplot(\n  # required options\n  object   = dynamic,           # input your dynamic model object\n  drop     = \"[[:digit:]]{2}\",  # this limits pre-post period to -9 to 9.\n  ref.line = FALSE,             # we will add our own line later\n  \n  # optional aesthetic options\n  xlab     = \"Time Relative to Treatment\",  # x-axis label\n  ylab     = \"Dynamic ATT Estimate\",        # y-axis label\n  main     = \"Dynamic Treatment Effects\",   # title for plot\n)\n\nplot +\n  geom_vline(xintercept = -0.5, linetype = 3) +               # add treatment begin line\n  geom_hline(yintercept = 0, linetype = 3, color = \"red\")     # add 0 effect line\n# ggfixest allows us to add any additional ggplot2 options\n\n\n\n\n\n\n\n\n\n\nHere we can see all of our dynamic treatment effects plotted. We can split the dynamic treatment effects into 2 groups for interpretation purposes.\n\nPre-treatment (before the white dotted line). If parallel trends assumption is met, then the confidence intervals of the estimates should cover 0 (the red line).\n\n\nIn this example, we can see evidence that parallel trends is violated.\n\n\nPost-treatment (after the white dotted line). These coefficients represent the treatment effect over time. If their confidence intervals do not include 0, that means the treatment effect is significant.\n\n\nIn this example, we can see the initial post-treatment periods have negative effects, but this becomes positive as the years go on.",
    "crumbs": [
      "Two-Way Fixed Effects"
    ]
  }
]