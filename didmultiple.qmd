# DIDmultiplegtDYN {.unnumbered}

::: small
R package for DIDmultiple estimator (de Chaisemartin and D'Haultfœuille 2024)
:::

**DIDmultiplegtDYN** is a package that implements the DIDmultiple estimator by de Chaisemartin and D'Haultfœuille (2024), that solves the issues with TWFE, handles non-absorbing and continuous treatments. Documentation can be found [here](https://cran.r-project.org/web/packages/DIDmultiplegtDYN/DIDmultiplegtDYN.pdf).

Install the package as follows:

```{r}
#| eval: false

install.packages('DIDmultiplegtDYN')
```

------------------------------------------------------------------------

#### sample code

Start by loading packages and the data:

```{r}
#| message: false
#| warning: false

library(DIDmultiplegtDYN)
library(ggplot2)  # for plotting
library(readr)    # for importing data
df = read_csv('df.csv')
```

<br />

We use the `did_multiplegt_dyn()` function to complete the estimation process.

::: small
If you have a continuous or quasi-continuous treatment, or are having issues, set `continuous = 1`. Covariates for conditional parallel trends are possible to include, but they are used differently, and may cause issues.
:::

```{r}
#| comment: "#>"
#| class-output: r
#| message: false
#| warning: false

mod = did_multiplegt_dyn(
  # required arguments
  df          = df,
  outcome     = "outcome",
  group       = "id",       # Note: group here refers to unit, not cohort
  time        = "time",
  treatment   = "treat",
  effects     = 4,          # Number of post-treatment periods dynamic effects
  placebo     = 4,          # Number of pre-treatment periods of effects
  controls    = NULL,       # optional, vector (string) of covariates.
  continuous  = NULL,       # change to 1 if your treatment is true
  graph_off   = T
)

mod |> print()
```

The `Estimation of treatment effects: Event-study effects` are the post-treatment dynamic effects. The `Average cumulative (total) effect per treatment unit` is the ATT estimate. The `Testing the parallel trends and no anticipation assumptions` is the pre-treatment coefficient estimates.

<br />

We can plot the dynamic treatment effects in a plot. The original estimation process already creates a (very flawed) plot, so we extract it and input it into ggplot.

```{r}
#| message: false
#| warning: false
#| fig-height: 3
#| fig-align: center



# assign plot to plot object
plot = mod$plot

# get rid of weird line in default plot
plot$layers[[1]] <- NULL

# customise plot
plot +
  labs(title = "Dynamic Treatment Effects") +
  xlab("Time to Treatment (t=1)") + ylab("Estimate") +
  
  # lines for treatment time and 0 treatment effect
  geom_vline(xintercept = 0.5, linetype = 3) +
  geom_hline(yintercept = 0, linetype = 3, color = "red") +
  theme_classic()
```
