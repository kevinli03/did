[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Difference-in-Differences (DiD) Resources",
    "section": "",
    "text": "Welcome!\n\nIntroduction\nDifference-in-differences (DiD) is one of the most widely used methods for estimating causal effects. It is often the go-to design for Policy analysts, Economists, and Epidemiologists.\nThis repository is a collection of resources on the causal identification strategy of Difference-in-Differences (DiD). This repository includes:\n\nA basic overview of DiD, including how it works, and the assumptions.\nOverview of the two-way fixed effects (TWFE) estimator.\nExploration of the issues with TWFE in staggered and non-absorbing settings.\nModern DiD estimators to deal with issues with TWFE.\nOther additional useful resources.\n\nThis repository was created to help me collect all that I had learned about DiD together into one place. I hope this can be helpful for others.\nI would like to thank the following individuals for teaching me so much about DiD and causal inference:\n\nDr. Aliz Toth\nDr. Daniel de Kadt\n\n\n\n\nAdditional Resources\nSome github pages:\n\nProfessor Yiqing Xu’s page on modern advancements in DiD.\nDr. Asjad Naqvi’s repository on DiD.\nCausal Inference: The Mixtape (textbook) chapter on DiD.\n\nSome influential papers:\n\nChiu et al (2025) ‘Causal Panel Analysis under Parallel Trends: Lessons from a Large Reanalysis Study’.\nRoth et al (2025) ‘What’s trending in difference-in-differences? A synthesis of the econometrics literature’.\nLiu et al (2025) ‘A Practical Guide to Counterfactual Estimators for Causal Inference with Time-Series Cross-Sectional Data’.",
    "crumbs": [
      "Welcome!"
    ]
  },
  {
    "objectID": "did.html",
    "href": "did.html",
    "title": "1  Basics of DiD",
    "section": "",
    "text": "What is DiD?\nDifference-in-differences (DiD) is a causal identification strategy that can help us estimate causal effects, and go from correlation to causation.\nFor an example, let us consider the famous paper by Card and Kreuger (1993).\n\nContext: New Jersey increased its minimum wage in April of 1992.\nQuestion: How did raising the minimum wage affect the employment rates at fast-food restaurants?\n\nWe have data on employment rates in New Jersey in March 1992, before the minimum wage increase, and data from December 1992, after the minimum wage increase. The data looks like this:\n\n\n\n\n\n\n\n\n\nBased on this data, it might be tempting to say something like this:\n\nThe employment rate in December 1992 is 4 units higher than than the employment rate in March. Thus, the causal effect of the minimum wage increase is 4 units.\n\nHowever, this would be the wrong conclusion. Why? Well something could have happened between March and December. Perhaps there was a giant country-wide economic boom which caused the increase in employment, which had nothing to do with minimum wage in New Jersey.\nDifference-in-differences is a solution to this problem. DiD tells us too look at another state - a state that did not receive the treatment. Nearby Pennsylvania did not increase its minimum wage during this time period. Let us see how their employment rate is doing:\n\n\n\n\n\n\n\n\n\nPennsylvania gives us the trend in employment rate if no minimum wage increase occurred. We then make an assumption - had New Jersey not undergone a minimum wage increase, it would have followed the same trend in employment rates.\n\n\n\n\n\n\n\n\n\nThus, difference-in-differences allows us to estimate the causal effect of a treatment by looking at the trend of an untreated unit, and using that trend to approximate what would have happened if the treatment never occurred.\n\n\n\nParallel Trends Assumption\nThe key assumption behind DiD is the parallel trends assumption - that indeed, New Jersey would have followed the same trend as Pennsylvania, had New Jersey not had the minimum wage increase. Or in the figures above, that New Jersey would have indeed followed the dotted purple line trend if it had not had a minimum wage increase.\nMore generally, the parallel trends assumption says that if the treated units had been hypothetically untreated, they would have followed the same trend in the outcome variable as the untreated units.\nWhat can go wrong when parallel trends is violated? Consider the same example above, but somehow, we were able to magically see what really happened to New Jersey without a minimum wage increase. Let us pretend that New Jersey alone (and not Pennsylvania) suffered from some mighty economic crash.\n\n\n\n\n\n\n\n\n\nWe can see that in this scenario, the true New Jersey trend (solid purple) is not parallel to the Pennsylvania trend. Thus, if we were to assume the Pennsylvania trend on the New Jersey trend (dotted purple), our estimate of the causal effect would be wrong.\nHow do we check the parallel trends assumption? Unfortunately, it is impossible to actually check it, since it involves a hypothetical outcome (New Jersey not getting the minimum wage increase).\nHowever, we often test for parallel trends in the years before the treatment starts (pre-treatment periods). The idea is that if there are parallel trends for several years before the start of treatment, then it is likely to continue into the treatment period.\n\n\n\nATT and Dynamic Effects\nThe main causal effect of interest in DiD is the average treatment effect on the treated (ATT). This is the causal effect of treatment on units that receive the treatment.\n\nImportant! This is not the same as the average treatment effect (ATE). That applies to all units, including untreated units. The ATT only applies to treated units, and cannot easily be generalised to untreated units.\n\nWe are often also interested in what is called dynamic treatment effects. These are essentially ATT estimates for every year in our data.\nFor example, let us say that after New Jersey legalised minimum wage, we continued to observe the employment rates for the next 5 years (as well as those in Pennsylvania). We can then create dynamic treatment effects for each of the next 5 years - which will help us visualise how the treatment effects change over time.\nDynamic treatment effects are also not only limited to the post-treatment period. If we had data before the treatment took place, we could also calculate dynamic treatment effects for each period. This is useful because we can use this to test for parallel trends.\nThis is because we shouldn’t expect the treatment and control groups to differ in their pre-treatment trends if parallel trends is met, and thus, the treatment effect should be 0 or close to 0 in the pre-treatment period. if this is not the case, then we have evidence that parallel trends is violated.\n\n\n\nStaggered and Absorbing\nDiD designs can be categorised by two factors: if treatment is staggered and if treatment is absorbing.\nNon-staggered treatment means all units that receive the treatment in our study receive it at the same time. For example, in our New Jersey example, all fast food restaurants in New Jersey experienced the minimum wage rise at the same time.\nStaggered treatment means units start treatment at different times in our study. This is often the case when we are studying multiple states - where some states begin some treatment earlier than others.\nAbsorbing treatment means units who get treated, always remain treated for the rest of our study. For example, in our New Jersey example, all fast food restaurants in New Jersey who got the minimum wage rise, remained with the higher minimum wage.\nNon-Absorbing treatment means units who get treated might return to being untreated. For example, this could happen if New Jersey decides a few years later to lower the minimum wage back to its original level.\nThese terms will become important when we explore the issues with two-way fixed effects, and why econometricians have spent 2021-onwards trying to solve those issues.\n\n\n\nWhen Can I Use DiD?\nDifference-in-differences can be used if the following characteristics are met:\nFirst, we must have either a panel dataset or repeated cross-section dataset over at least 2 years.\n\nA panel dataset is when we observe the same units/individuals over multiple time periods. For example, we observe Bob, Anna, and James in year 1 and year 2.\nA repeated cross-section dataset is when we observe different units from the same groups over multiple periods. For example, we have a sample of individuals from California in year 1, and another sample of individuals from California in year 2.\n\nSecond, we must have a never-treated group and a treated group. The never-treated group never receives the treatment, no matter what year we are in. The treated group receives the treatment sometime during the time period of our dataset.\nThird, we must have variation in time of adopting the treatment for the treated group. This means we cannot have the treated group start out treated and remain treated for the entirety of our data/study. We need the treated group to start out untreated, then during the course of the study, receive treatment.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Basics of DiD</span>"
    ]
  },
  {
    "objectID": "twfe.html",
    "href": "twfe.html",
    "title": "2  Two-Way Fixed Effects",
    "section": "",
    "text": "What is TWFE?\nTwo-way fixed effects (TWFE) is the primary estimator used to estimate causal effects in difference-in-differences. The TWFE estimator is a regression model specified as follows:\n\\[\nY_{it} = \\underbrace{\\alpha_i + \\gamma_t}_\\text{fixed effects} + D_{it}\\tau + \\cov + \\eps_{it}\n\\]\nThe variables in this regression model are:\n\n\\(Y_{it}\\) is our outcome variable value for unit \\(i\\) at time \\(t\\).\n\\(D_{it}\\) is our treatment variable value (treated = 1, not treated = 0) for unit \\(i\\) at time \\(t\\).\n\\(\\mathbf X_{it}\\) is a vector of covariate variable values for unit \\(i\\) at time \\(t\\). These covariates are optional, and are used if we believe they are needed to meet the parallel trends assumption.\n\nFixed effect \\(\\alpha_i\\) accounts/controls for differences between units, and \\(\\gamma_t\\) accounts/controls for differences between time periods.\nIf we account for differences between units and differences between time periods, the only possible confounders remaining are unit-specific trends over time. But with the parallel trends assumption, we rule out this type of confounder.\nThus, under the parallel trends assumption, there are no omitted confounders/variables, and our regression is exogenous. Since OLS is unbiased under exogeneity, our TWFE estimator for \\(\\tau\\) is unbiased.\nThere are issues with TWFE that you should understand before relying on TWFE.\n\n\n\nR: Estimating the ATT\nOur dataset df should have the following variables:\n\nunit: variable indicating units \\(i\\) in our dataset.\ntime: variable indicating the time-periods \\(t\\) in our dataset.\ntreat: variable indicating the treatment status of unit \\(i\\) at time-period \\(t\\). Should equal 1 if treated, and 0 if not treated.\noutcome: variable indicating the outcome value of unit \\(i\\) at time-period \\(t\\).\n\nWe can also have these optional variables:\n\ncovariate: a control variable (if needed) to meet parallel trends. We can have multiple.\n\nWe then use the feols() command to run a TWFE model:\n\nlibrary(fixest)\n\natt &lt;- feols(\n  fml   = outcome ~ treat + covariate | unit + time,  # covariate is optional\n  data  = df,                                         # your data\n  vcov  = ~unit                                       # cluster SE by unit\n)\n\nsummary(att)\n\n#&gt; OLS estimation, Dep. Var.: outcome\n#&gt; Observations: 950\n#&gt; Fixed-effects: unit: 95,  time: 10\n#&gt; Standard-errors: Clustered (unit) \n#&gt;           Estimate Std. Error t value  Pr(&gt;|t|)    \n#&gt; covariate  1.00364   0.036917 27.1867 &lt; 2.2e-16 ***\n#&gt; ... 1 variable was removed because of collinearity (treat)\n#&gt; ---\n#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#&gt; RMSE: 1.85913     Adj. R2: 0.58805 \n#&gt;                 Within R2: 0.497278\n\n\nThe coefficient of treat is our estimate of the ATT - the causal effect of treatment on those who receive the treatment. The significance is given by Pr(&gt;|t|) (the p-value) and the stars *** .\n\n\n\nR: Estimating Dynamic Effects\nWe can also estimate dynamic treatment effects with the TWFE estimator. Our dataset df should have the following variables:\n\nunit: variable indicating units \\(i\\) in our dataset.\ntime: variable indicating the time-periods \\(t\\) in our dataset.\noutcome: variable indicating the outcome value of unit \\(i\\) at time-period \\(t\\).\nrel.time: a relative time variable that indicates for period \\(t\\), how many periods away unit \\(i\\) first received treatment (0 is the year they received treatment, negatives are before treatment, positives after treatment). For info on how to create this variable, see the appendix.\n\nWe can also have these optional variables:\n\ncovariate: a control variable (if needed) to meet parallel trends. We can have multiple.\n\nWe then use the feols() command to run a TWFE model for dynamic effects:\n\nlibrary(fixest)\n\ndynamic &lt;- feols(\n  # Formula\n  fml   = outcome ~ i(rel.time, ref = c(-1, Inf)) + covariate | unit + time,\n  # Do not change -1 in c(). You change Inf to the value of never-treated for rel.time\n  \n  data  = df,     # your data\n  vcov  = ~unit   # cluster SE by unit\n)\n\nhead(coeftable(dynamic))  # head because this table is long\n\n#&gt;               Estimate Std. Error  t value     Pr(&gt;|t|)\n#&gt; rel.time::-9 1.7984987  0.3437712 5.231674 1.016192e-06\n#&gt; rel.time::-8 1.0656900  0.3096144 3.441991 8.635334e-04\n#&gt; rel.time::-7 1.2141806  0.3946458 3.076634 2.742407e-03\n#&gt; rel.time::-6 1.0763716  0.3581856 3.005067 3.404009e-03\n#&gt; rel.time::-5 0.6572517  0.2985581 2.201419 3.015397e-02\n#&gt; rel.time::-4 0.6103575  0.2886039 2.114862 3.708716e-02\n\n\nThe output here contains the dynamic effects from rel.time periods -20 to -15. You can see more of them if you get rid of the head() function surrounding the coeftable(dynamic).\nThese results aren’t too useful on their own. It is much more useful to plot these results.\n\nlibrary(ggfixest)\nlibrary(ggplot2)\n\nplot &lt;- ggiplot(\n  # required options\n  object   = dynamic,           # input your dynamic model name\n  drop     = \"[[:digit:]]{2}\",  # this limits pre-post period to -9 to 9.\n  ref.line = FALSE,             # we will add our own line later\n  \n  # optional aesthetic options\n  xlab     = \"Time Relative to Treatment\",  # x-axis label\n  ylab     = \"Dynamic ATT Estimate\",        # y-axis label\n  main     = \"Dynamic Treatment Effects\",   # title for plot\n)\n\nplot +\n  geom_vline(xintercept = -0.5, linetype = 3) +               # add treatment begin line\n  geom_hline(yintercept = 0, linetype = 3, color = \"red\")     # add 0 effect line\n# ggfixest allows us to add any additional ggplot2 options\n\n\n\n\n\n\n\n\n\n\nHere we can see all of our dynamic treatment effects plotted. We can split the dynamic treatment effects into 2 groups for interpretation purposes.\n\nPre-treatment (before the white dotted line). If parallel trends assumption is met, then the confidence intervals of the estimates should cover 0 (the red line).\n\n\nIn this example, we can see evidence that parallel trends is violated.\n\n\nPost-treatment (after the white dotted line). These coefficients represent the treatment effect over time. If their confidence intervals do not include 0, that means the treatment effect is significant.\n\n\nIn this example, we can see the initial post-treatment periods have negative effects, but this becomes positive as the years go on.\n\n\n\n\nIssues with TWFE\nTWFE has been shown to be a biased estimator (bad estimator) for the ATT and dynamic treatment effects when dealing with staggered treatment implementation. So when units begin treatment at different times, TWFE is biased.\nWhy is this? Goodman-Bacon (2021) shows that in a staggered setting, TWFE is actually a weighted average of 4 comparisons:\n\nEarly-treated units vs. untreated units.\nLate-treated units vs. untreated units.\nEarly-treated units vs. late-treated units before treatment.\nEarly-treated units after treatment vs. late-treated units before and after treatment.\n\nWhen we compare treatment to control, we want to compare treated to untreated units. The issue comes with the 4th comparison - we actually use late-treated units after receiving treatment as a untreated comparison. This is called the “forbidden comparison” problem of TWFE.\nDe Chaisemartin and D’Haultœuille (2020) show that there is another problem with TWFE - the weighting of these comparisons when aggregating these comparisons. For an accurate average treatment effect on the treated (ATT), we in theory want to weight each comparison by the proportion of the sample size each comparison contains. For example, if more units are in the early-treated units, we would want to weight that comparison more.\nThe issue with TWFE is that not only does it not weight by group size, it doesn’t even always give positive weights. In fact, sometimes, TWFE will assign negative weights to certain comparisons. This is completely nonsensical, and has been shown to even reverse the sign of the true ATT in simulations.\nThus, TWFE is a biased estimator when it comes to staggered treatment designs. Since 2021, Econometricians have started developing modern estimators that resolve the issues with TWFE.\n\n\n\n\nWhen to Use TWFE?\nWe have established that TWFE is a biased estimator when it comes to staggered treatment designs. Thus, we should be cautious when using TWFE in these situations.\nThe general advice is to not rely on TWFE if there is any staggered treatment implementation or non-absorbing treatment.\nHowever, while we cannot rely on TWFE, it is still very conventional to estimate a TWFE model and report the results. While in theory TWFE can be very biased (as explained above), in reality, it often is not that different than any other modern estimators.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Two-Way Fixed Effects</span>"
    ]
  }
]